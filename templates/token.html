{% extends "dashboard_base.html" %}

{% block title %}SecureAlgo - Symbol Search{% endblock %}
{% block page_title %}Symbol Search{% endblock %}

{% block head %}
<title>SecureAlgo - Symbol Search</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<style>
    .form-container {
        padding: 2rem;
        background-color: #111827;
        border-radius: 0.5rem;
        border: 1px solid #374151;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -2px rgba(0, 0, 0, 0.3);
        width: 100%;
        /* Maximum width */
        max-width: 32rem;
        /* Maximum width set to 32rem */
    }

    input[type="text"],
    input[type="submit"],
    select {
        padding: 0.5rem 1rem;
        background-color: #1f2937;
        color: #e5e7eb;
    }

    input[type="text"],
    select {
        border: 2px solid #374151;
        border-radius: 0.375rem;
        /* 6px */
    }

    input[type="text"]::placeholder {
        color: #9ca3af;
    }

    input[type="submit"] {
        background-color: #ff6b35;
        color: #e5e7eb;
        border: none;
        border-radius: 0.375rem;
        /* 6px */
        cursor: pointer;
    }

    input[type="submit"]:hover {
        background-color: #ff9500;
    }

    /* Autocomplete styling */
    .ui-autocomplete {
        max-height: 300px;
        overflow-y: auto;
        overflow-x: hidden;
        z-index: 9999 !important;
        background-color: #1f2937;
        border: 1px solid #374151;
    }

    .ui-menu-item {
        padding: 5px;
        font-size: 14px;
        color: #e5e7eb;
    }

    .ui-menu-item:hover {
        background-color: #ff6b35;
        color: #ffffff;
        cursor: pointer;
    }

    .ui-helper-hidden-accessible {
        display: none;
    }
</style>
<script>
    $(document).ready(function () {
        $("#symbol-input").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "/search/suggestions",
                    dataType: "json",
                    data: {
                        term: request.term,
                        exchange: $("#exchange-select").val()
                    },
                    success: function (data) {
                        response(data);
                    }
                });
            },
            minLength: 1,
            select: function (event, ui) {
                $("#symbol-input").val(ui.item.value);
                return false;
            }
        }).autocomplete("instance")._renderItem = function (ul, item) {
            return $("<li>")
                .append("<div><strong>" + item.value + "</strong> - " + item.label.split(" - ")[1] + "</div>")
                .appendTo(ul);
        };

        // Update suggestions when exchange changes
        $("#exchange-select").change(function () {
            if ($("#symbol-input").val().length >= 1) {
                $("#symbol-input").autocomplete("search", $("#symbol-input").val());
            }
        });
    });
</script>
{% endblock %}

{% block content %}
<div class="form-container mx-auto my-8">
    <h1 class="text-xl font-bold mb-4" style="color: #ff6b35;">Symbol Search</h1>
    <form action="/search" method="get" class="flex flex-col gap-4">
        <input id="symbol-input" type="text" name="symbol" placeholder="Enter symbol" required
            class="input text-sm border-gray-700 focus:border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50 rounded-md shadow-sm">
        <!-- Exchange dropdown menu -->
        <select id="exchange-select" name="exchange" required
            class="input text-sm border-gray-700 focus:border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50 rounded-md shadow-sm">
            <option value="">Select Exchange</option>
            <option value="NSE" selected>NSE</option>
            <option value="NFO">NFO</option>
            <option value="BSE">BSE</option>
            <option value="BFO">BFO</option>
            <option value="CDS">CDS</option>
            <option value="MCX">MCX</option>
            <option value="NSE_INDEX">NSE_INDEX</option>
            <option value="BSE_INDEX">BSE_INDEX</option>
        </select>
        <input type="submit" value="SEARCH" class="btn text-gray-200 font-bold py-2 px-4 rounded uppercase"
            style="background-color: #ff6b35;" onmouseover="this.style.backgroundColor='#ff9500'"
            onmouseout="this.style.backgroundColor='#ff6b35'">
    </form>
</div>
{% endblock %}